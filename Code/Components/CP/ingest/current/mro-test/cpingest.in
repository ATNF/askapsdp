#
# Central Processor Ingest Pipeline Configuration
#

#
# Array Name
#
arrayname = ASKAP

#
# Feed Configurations
#
feeds.names                 = [PAF36]
feeds.PAF36.n_feeds         = 36
feeds.PAF36.spacing         = 1deg

feeds.PAF36.feed0           = [0., 0.]
feeds.PAF36.feed1           = [0., 0.]
feeds.PAF36.feed2           = [0., 0.]
feeds.PAF36.feed3           = [0., 0.]
feeds.PAF36.feed4           = [0., 0.]
feeds.PAF36.feed5           = [0., 0.]
feeds.PAF36.feed6           = [0., 0.]
feeds.PAF36.feed7           = [0., 0.]
feeds.PAF36.feed8           = [0., 0.]
feeds.PAF36.feed9           = [0., 0.]


#feeds.PAF36.feed0           = [-2.5, -2.5]
#feeds.PAF36.feed1           = [-2.5, -1.5]
#feeds.PAF36.feed2           = [-2.5, -0.5]
#feeds.PAF36.feed3           = [-2.5,  0.5]
#feeds.PAF36.feed4           = [-2.5,  1.5]
#feeds.PAF36.feed5           = [-2.5,  2.5]

#feeds.PAF36.feed6           = [-1.5, -2.5]
#feeds.PAF36.feed7           = [-1.5, -1.5]
#feeds.PAF36.feed8           = [-1.5, -0.5]
#feeds.PAF36.feed9           = [-1.5,  0.5]
feeds.PAF36.feed10          = [-1.5,  1.5]
feeds.PAF36.feed11          = [-1.5,  2.5]

feeds.PAF36.feed12          = [-0.5, -2.5]
feeds.PAF36.feed13          = [-0.5, -1.5]
feeds.PAF36.feed14          = [-0.5, -0.5]
feeds.PAF36.feed15          = [-0.5,  0.5]
feeds.PAF36.feed16          = [-0.5,  1.5]
feeds.PAF36.feed17          = [-0.5,  2.5]

feeds.PAF36.feed18          = [0.5, -2.5]
feeds.PAF36.feed19          = [0.5, -1.5]
feeds.PAF36.feed20          = [0.5, -0.5]
feeds.PAF36.feed21          = [0.5,  0.5]
feeds.PAF36.feed22          = [0.5,  1.5]
feeds.PAF36.feed23          = [0.5,  2.5]

feeds.PAF36.feed24          = [1.5, -2.5]
feeds.PAF36.feed25          = [1.5, -1.5]
feeds.PAF36.feed26          = [1.5, -0.5]
feeds.PAF36.feed27          = [1.5,  0.5]
feeds.PAF36.feed28          = [1.5,  1.5]
feeds.PAF36.feed29          = [1.5,  2.5]

feeds.PAF36.feed30          = [2.5, -2.5]
feeds.PAF36.feed31          = [2.5, -1.5]
feeds.PAF36.feed32          = [2.5, -0.5]
feeds.PAF36.feed33          = [2.5,  0.5]
feeds.PAF36.feed34          = [2.5,  1.5]
feeds.PAF36.feed35          = [2.5,  2.5]

#
# Antennas
#
#antennas.names              = [AK01,AK03,AK06,AK08,AK09,AK15]
#antennas.names              = [AK06,AK01,AK03,AK15,AK08,AK09]
antennas.names              = [AK06,AK01,AK03]
#antennas.names              = [AK15,AK08,AK09]

# antenna positions copied from sw-correlator parset
antennas.AK01.location     = [-2556084.669, 5097398.337, -2848424.133]
antennas.AK01.diameter     = 12m
antennas.AK01.mount        = equatorial
antennas.AK01.feed_config  = PAF36

antennas.AK03.location     = [-2556118.102, 5097384.726, -2848417.280]
antennas.AK03.diameter     = 12m
antennas.AK03.mount        = equatorial
antennas.AK03.feed_config  = PAF36

antennas.AK06.location     = [-2556227.863, 5097380.399, -2848323.367]
antennas.AK06.diameter     = 12m
antennas.AK06.mount        = equatorial
antennas.AK06.feed_config  = PAF36

# # easting: 463296.230000; northing: 7046832.500000; el: 370.810000; Zone: 50 south
# # lat: -26.699153192237; long: 116.631037279591; el: 370.810000
antennas.AK08.location     = [-2556005.813742, 5097327.008027, -2848641.257970]
antennas.AK08.diameter     = 12m
antennas.AK08.mount        = equatorial
antennas.AK08.feed_config  = PAF36

# # easting: 463089.830000; northing: 7047181.560000; el: 370.110000; Zone: 50 south
# # lat: -26.695996195140; long: 116.628972698055; el: 370.110000
antennas.AK09.location     = [-2555892.578900, 5097559.600315, -2848328.739449]
antennas.AK09.diameter     = 12m
antennas.AK09.mount        = equatorial
antennas.AK09.feed_config  = PAF36


antennas.AK15.location  = [-2555394.936910,5097674.796317,-2848567.461727]
antennas.AK15.diameter     = 12m
antennas.AK15.mount        = equatorial
antennas.AK15.feed_config  = PAF36

# # easting: 463899.970000; northing: 7047824.220000; el: 364.280000; Zone: 50 south
# # lat: -26.690214789597; long: 116.637134608883; el: 364.280000
antennas.AK29.location     = [-2556745.438405, 5097448.114406, -2847753.833282]
antennas.AK29.diameter     = 12m
antennas.AK29.mount        = equatorial
antennas.AK29.feed_config  = PAF36

#
# Baseline mapping:
# Used for mapping from baselineid to antenna1/antenna2/polarisation product
# Mapping is from baselineid to (ant1, ant2,  product)
#
baselinemap.baselineids            = [1..21]

baselinemap.1                      = [0, 0, XX]
baselinemap.2                      = [0, 0, XY]
baselinemap.3                      = [0, 1, XX]
baselinemap.4                      = [0, 1, XY]
baselinemap.5                      = [0, 2, XX]
baselinemap.6                      = [0, 2, XY]
baselinemap.7                      = [0, 0, YY]
baselinemap.8                      = [0, 1, YX]
baselinemap.9                      = [0, 1, YY]
baselinemap.10                     = [0, 2, YX]
baselinemap.11                     = [0, 2, YY]

baselinemap.12                     = [1, 1, XX]
baselinemap.13                     = [1, 1, XY]
baselinemap.14                     = [1, 2, XX]
baselinemap.15                     = [1, 2, XY]
baselinemap.16                     = [1, 1, YY]
baselinemap.17                     = [1, 2, YX]
baselinemap.18                     = [1, 2, YY]

baselinemap.19                     = [2, 2, XX]
baselinemap.20                     = [2, 2, XY]
baselinemap.21                     = [2, 2, YY]

#
#  Observation specific
#
observation.sbid                    = 0
observation.scan0.field_name        = test-field
# Virgo
#observation.scan0.field_direction   = [12h30m49.43, +12.23.28.01, J2000]
# 0407-658
#observation.scan0.field_direction   = [04h08m20.38, -65.45.09.1, J2000]
# 1934-638
observation.scan0.field_direction   = [19h39m25.026, -63.42.45.63, J2000]
# 1549-790
#observation.scan0.field_direction   = [15h56m58.871, -79.14.04.28, J2000]




observation.scan0.start_freq        = 1.0155GHz
observation.scan0.n_chan            = 16416
observation.scan0.chan_width        = -18.518518kHz
observation.scan0.stokes            = [XX, XY, YX, YY]
observation.scan0.interval          = 5000000

#
# Task List
#
#tasks.tasklist                          = [NoMetadataSource, CalcUVWTask, MSSink]
tasks.tasklist                          = [NoMetadataSource, PhaseTrackTask,CalcUVWTask, Monitor, MSSink]
#tasks.tasklist                          = [NoMetadataSource, PhaseTrackTask,ChanFlag,CalcUVWTask, ChannelAvgTask,Monitor, MSSink]
#tasks.tasklist                          = [NoMetadataSource, PhaseTrackTask,ChanSel, CalcUVWTask, Monitor, MSSink]
#tasks.tasklist                          = [NoMetadataSource, CalcUVWTask, ChannelAvgTask, Monitor,MSSink]
#tasks.tasklist                          = [NoMetadataSource, ChanFlag, CalcUVWTask, Monitor,MSSink]
#tasks.tasklist                          = [NoMetadataSource, CalcUVWTask, PhaseTrackTask,FlagEven,ChanSel,ChannelAvgTask,Monitor,MSSink]

#tasks.tasklist                          = [NoMetadataSource, CalcUVWTask, Monitor,MSSink]

#tasks.tasklist                          = [NoMetadataSource, CalcUVWTask, PhaseTrackTask,ChanFlag,ChanSel, Monitor,MSSink]
#tasks.tasklist                          = [NoMetadataSource, CalcUVWTask, PhaseTrackTask,ChanSel,ChannelAvgTask, Monitor,MSSink]
#tasks.tasklist                          = [NoMetadataSource, PhaseTrackTask,ChanFlag,ChanSel,CalcUVWTask,ChannelAvgTask, Monitor,MSSink]

#
# PhaseTrackTask
#
tasks.PhaseTrackTask.type  = PhaseTrackTask
tasks.PhaseTrackTask.params.trackdelay  = False
tasks.PhaseTrackTask.params.trackedsouthpole = True

#
# NoMetadataSource
#
tasks.NoMetadataSource.type                             = NoMetadataSource
tasks.NoMetadataSource.params.vis_source.port           = 16384
tasks.NoMetadataSource.params.vis_source.buffer_size    = 24192

# Number of channels a given ingest process is meant to receive/process
tasks.NoMetadataSource.params.n_channels.0              = 16416
#tasks.NoMetadataSource.params.beammap = "1:0,2:1,3:2,4:3,5:4,6:5,7:6,8:7,9:8,10:9,11:10,12:11,13:12,14:13,15:14,16:15,17:16,18:17,19:18,20:19,21:20,22:21,23:22,24:23,25:24,26:25,27:26,28:27,29:28,30:29,31:30,32:31,33:32,34:33,35:34,36:35"
tasks.NoMetadataSource.params.beammap = "1:0,2:1,3:2,4:3,5:4,6:5,7:6,8:7,9:8"
#tasks.NoMetadataSource.params.beammap = "1:0,2:1,3:2,4:3,5:4"
#tasks.NoMetadataSource.params.maxbeams = 9
#tasks.NoMetadataSource.params.maxbeams = 36
tasks.NoMetadataSource.params.beams2receive = 36


#
# CalcUVWTask
#
tasks.CalcUVWTask.type                  = CalcUVWTask

#
# ChannelAvgTask
#
tasks.ChannelAvgTask.type               = ChannelAvgTask
tasks.ChannelAvgTask.params.averaging   = 54
#tasks.ChannelAvgTask.params.averaging   = 5
#tasks.ChannelAvgTask.params.averaging   = 27

# ChannelSelTask
tasks.ChanSel.type        = ChannelSelTask
tasks.ChanSel.params.start = 4000
tasks.ChanSel.params.nchan = 3996
#tasks.ChanSel.params.start = 200
#tasks.ChanSel.params.nchan = 800
#tasks.ChanSel.params.nchan = 12474
#tasks.ChanSel.params.start = 95
#tasks.ChanSel.params.nchan = 5


# SimpleMonitor
tasks.Monitor.type  = SimpleMonitorTask
tasks.Monitor.params.baselineids = [0,1,2]
tasks.Monitor.params.0 = [0,1,YY]
tasks.Monitor.params.1 = [1,2,YY]
tasks.Monitor.params.2 = [0,2,YY]

#tasks.Monitor.params.0 = [0,0,XX]
#tasks.Monitor.params.1 = [1,1,XX]
#tasks.Monitor.params.2 = [2,2,XX]

#tasks.Monitor.params.0 = [0,0,XX]
#tasks.Monitor.params.1 = [0,0,YY]
#tasks.Monitor.params.2 = [0,0,XY]
tasks.Monitor.params.nbeam = 9

# channel flagger
tasks.ChanFlag.type  = ChannelFlagTask
tasks.ChanFlag.params.baselineids = [0,1,2,3,4,5]
#tasks.ChanFlag.params.flagfiles = [flags63xx.dat,flags63xx.dat,flags61xx.dat,flags61xx.dat,flags13xx.dat,flags13xx.dat]

# generated_flags flags only dc-offset birdies
tasks.ChanFlag.params.flagfiles = [generated_flags.txt, generated_flags.txt, generated_flags.txt, generated_flags.txt, generated_flags.txt, generated_flags.txt] 
tasks.ChanFlag.params.0 = [0,2,XX]
tasks.ChanFlag.params.1 = [0,2,YY]
tasks.ChanFlag.params.2 = [0,1,XX]
tasks.ChanFlag.params.3 = [0,1,YY]
tasks.ChanFlag.params.4 = [1,2,XX]
tasks.ChanFlag.params.5 = [1,2,YY]


tasks.FlagEven.type  = ChannelFlagTask
tasks.FlagEven.params.baselineids = [0,1,2,3,4,5]
tasks.FlagEven.params.flagfiles = [evenchannels.dat, evenchannels.dat, evenchannels.dat, evenchannels.dat, evenchannels.dat, evenchannels.dat] 
tasks.FlagEven.params.0 = [0,2,XX]
tasks.FlagEven.params.1 = [0,2,YY]
tasks.FlagEven.params.2 = [0,1,XX]
tasks.FlagEven.params.3 = [0,1,YY]
tasks.FlagEven.params.4 = [1,2,XX]
tasks.FlagEven.params.5 = [1,2,YY]

#
# MSSink
#
tasks.MSSink.type                       = MSSink
tasks.MSSink.params.filename            = /data/AKSCOR01_2/scratch/vor010/MS/%d_%t.ms
tasks.MSSink.params.stman.bucketsize    = 131072
tasks.MSSink.params.stman.tilencorr     = 4
tasks.MSSink.params.stman.tilenchan     = 1026
